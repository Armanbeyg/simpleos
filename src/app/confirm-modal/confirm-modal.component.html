<clr-modal [(clrModalOpen)]="visibility" [clrModalStaticBackdrop]="true" (clrModalOpenChange)="onClose()">
    <h3 class="modal-title" style="display: contents;">Confirm <span class="highlight-primary"
                                                                     [innerHTML]="modalData.actionTitle"></span></h3>


    <div class="modal-body">

        <ng-container *ngIf="loadResource">
            <h5 class="mt-0 text-center">Loading
                <fa-icon [icon]="['far', 'spinner']" [pulse]="true"></fa-icon>
            </h5>
        </ng-container>
        <ng-container *ngIf="!loadResource">
            <h5 class="mt-0">Account: {{modalData.signerAccount}}</h5>


            <ng-container *ngIf="modalData.labelHTML === ''">
                <p-accordion>
                    <p-accordionTab *ngFor="let act of modalData.transactionPayload.actions; let i = index"
                                    header="{{act.name}} on {{act.account}}"
                                    [selected]="i === 0">
                        <ngx-json-viewer width="300" [json]="act.data" [expanded]="true"
                                         class="transit-json"></ngx-json-viewer>
                    </p-accordionTab>
                </p-accordion>
                <h4 [innerHTML]="modalData.labelHTML | safe: 'html'"></h4>
            </ng-container>

            <ng-container *ngIf="modalData.resourceInfo['relay'] && useBorrowRex==='0'">
                <mat-card class="info-resource">
                    <h5>
                        <fa-icon [icon]="['fas','lightbulb-on']"></fa-icon>
                        Hey, we've got your back! You have {{modalData.resourceInfo['relayCredit']['limit']}} free
                        transactions per day with SimplEOS.
                        <br>
                        <br>
                        You still have {{modalData.resourceInfo['relayCredit']['used']}} free transactions for today
                        including this one.

                        <br>
                        <mat-radio-group [(ngModel)]="useFreeTransaction" class="free-transaction-radio"
                                         aria-label="Select an option" color="accent">
                            <mat-radio-button value="1" (change)="toggleHelp($event,true)">Yes, please!
                            </mat-radio-button>
                            <mat-radio-button value="0" (change)="toggleHelp($event,true)" style="margin-left: 20px;">
                                No, thanks!
                            </mat-radio-button>
                        </mat-radio-group>
                    </h5>
                </mat-card>
            </ng-container>

            <ng-container *ngIf="modalData.resourceInfo['needResources'] && useFreeTransaction==='0'">
                <mat-card class="info-resource">
                    <h5 class="modal-title ">
                        Ops, not enough resources <a role="tooltip" aria-haspopup="true"
                                                     class="tooltip tooltip-sm tooltip-left" style="margin-left: 7px">
                        <fa-icon [icon]="['far','question-circle']" class="highlight-primary"></fa-icon>
                        <span class="tooltip-content">
                            Looks like you do not have enough network resources to perform this action.<br>
                        </span>
                    </a><br><br>
                        No problem! We got your back!<br><br>
                        We can rent resources on Power UP to pay for the resources. It will cost <span
                            class="highlight-secondary">{{resource.resourceInfo['spend'].toFixed(resource.resourceInfo['precision']) + ' ' + resource.resourceInfo['tk_name']}}</span>.
                        <br>
                        <br>
                        <mat-radio-group [(ngModel)]="useBorrowRex" class="free-transaction-radio"
                                         aria-label="Select an option" color="accent">
                            <mat-radio-button value="1" (change)="toggleHelp($event,false)">Yes, please!
                            </mat-radio-button>
                            <mat-radio-button value="0" (change)="toggleHelp($event,false)" style="margin-left: 20px;">
                                No, thanks!
                            </mat-radio-button>
                        </mat-radio-group>
                    </h5>
                </mat-card>
            </ng-container>

            <ng-container *ngIf="modalData.labelHTML !== ''">
                <h4 [innerHTML]="modalData.labelHTML | safe: 'html'"></h4>
            </ng-container>

            <h5 class="mt-0"></h5>

            <!--            <ng-container *ngIf="modalData.termsHeader !=='' && modalData.termsHTML !== ''">-->
            <!--                <p-accordion>-->
            <!--                    <p-accordionTab>-->
            <!--                        <p-header>-->
            <!--                            <div style="display: contents;" [innerHTML]="modalData.termsHeader"></div>-->
            <!--                        </p-header>-->
            <!--                        <div [innerHTML]="modalData.termsHTML"></div>-->
            <!--                    </p-accordionTab>-->
            <!--                </p-accordion>-->
            <!--            </ng-container>-->
        </ng-container>
    </div>

    <div class="modal-footer">
        <ng-container *ngIf="!loadResource">
            <div fxLayout="column" style="width: 100%; padding: 0 .15rem;">
                <div class="row">
                    <div class="col-12">
                        <h5 class="highlight-primary my-2">Sign with:</h5>
                        <mat-chip-list aria-label="Authorization selection">
                            <mat-chip *ngFor="let perm of allAuth;let idx = index"
                                      (click)="selectAuth([perm.auth,perm.pubKey])"
                                      [selected]="perm.auth.permission===selectedAuth">
                                {{perm.auth.permission}}
                            </mat-chip>
                        </mat-chip-list>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <ng-container *ngIf="mode === 'local'">
                            <form [formGroup]="confirmationForm" fxLayout="row" fxLayoutAlign="end center">
                                <mat-form-field style="margin-top: 15px;">
                                    <input matInput
                                           cdkTrapFocus
                                           #pass="matInput"
                                           type="password"
                                           formControlName="pass"
                                           (keyup.enter)="executeAction(pass.value);"
                                           placeholder="Password">
                                </mat-form-field>

                                <button type="button" class="btn btn-info-outline"
                                        (click)="executeAction(pass.value);" [disabled]="busy">
                                    Confirm
                                    <fa-icon [icon]="['far','spinner']" [spin]="true" *ngIf="busy"></fa-icon>
                                </button>

                            </form>
                        </ng-container>

                        <div fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="20px"
                             *ngIf="mode === 'ledger'">
                    <span class="text-faded">device: {{requiredLedgerInfo.device}}
                        - slot: {{requiredLedgerInfo.slot}}</span>
                            <button type="button" class="btn btn-info-outline"
                                    style="margin-top: 12px;" (click)="signLedger()">
                                sign with ledger
                                <fa-icon [icon]="['far','spinner']" [spin]="true" *ngIf="busy"></fa-icon>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="error error-modal-footer" *ngIf="errormsg['friendly']!==''">
                    <fa-icon [icon]="['fas','exclamation-triangle']" class="mr-1"></fa-icon>
                    {{errormsg['friendly']}}
                    <ng-container *ngIf="errormsg['origin']!==''">
                        <p-accordion class="error error-accordion">
                            <p-accordionTab header="Advanced">
                                {{errormsg['origin']}}
                            </p-accordionTab>
                        </p-accordion>
                    </ng-container>
                </div>
            </div>
        </ng-container>
    </div>

</clr-modal>
